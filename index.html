<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>MatchMind: –§–æ—Ç–æ–ü–∞–º—è—Ç—å ‚Äî v1.0</title>

<!-- Telegram WebApp SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,Arial,sans-serif}

body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#eef1f6;
}

.game{
  width:100%;
  max-width:520px;
  padding:26px;
  border-radius:22px;
  background:#eef1f6;
  box-shadow:12px 12px 24px #d6dae0,-12px -12px 24px #fff;
  text-align:center;
}

h1{margin-bottom:16px}

.controls-start{display:flex;flex-direction:column;gap:14px;margin-bottom:16px}
.mode-buttons{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
}

@keyframes warnBlink{
  0%{box-shadow:6px 6px 12px #cfd3da,-6px -6px 12px #fff}
  25%{box-shadow:0 0 0 3px rgba(255,140,0,1)}
  50%{box-shadow:6px 6px 12px #cfd3da,-6px -6px 12px #fff}
  75%{box-shadow:0 0 0 3px rgba(255,140,0,1)}
  100%{box-shadow:6px 6px 12px #cfd3da,-6px -6px 12px #fff}
}

@keyframes inputBounce{
  0%{transform:translateY(0)}
  30%{transform:translateY(-6px)}
  55%{transform:translateY(0)}
  75%{transform:translateY(-3px)}
  100%{transform:translateY(0)}
}

button.warn{
  animation:warnBlink 0.8s ease-in-out;
}

button{
  padding:12px 20px;
  font-size:15px;
  border:none;
  border-radius:14px;
  background:#eef1f6;
  cursor:pointer;
  box-shadow:6px 6px 12px #cfd3da,-6px -6px 12px #fff;
  transition:transform .12s ease, box-shadow .12s ease;
}
button:active{
  transform:scale(.96);
  box-shadow: inset 4px 4px 8px #cfd3da,inset -4px -4px 8px #fff;
}

button.active{outline:3px solid #4caf50}

input{
  transition: box-shadow .25s, background-color .25s;
  width:90px;
  padding:8px;
  font-size:16px;
  text-align:center;
  border-radius:12px;
  border:none;
  background:#eef1f6;
  box-shadow: inset 4px 4px 8px #cfd3da,inset -4px -4px 8px #fff
}

input.input-warn{
  background:#fff3e0;
  box-shadow:0 0 0 3px rgba(255,140,0,.9);
  animation: inputBounce 0.35s ease-out;
}

.field{
  position:relative;
  height:320px;
  padding:10px;
  border-radius:18px;
  background:#eef1f6;
  box-shadow: inset 6px 6px 12px #cfd3da,inset -6px -6px 12px #fff;
  overflow:hidden;
}

@media (max-width:480px){
  .field{height:280px}
  button{padding:14px 22px;font-size:16px}
  .object{transform:scale(.92) rotate(var(--rot,0deg))}
}

.hidden{display:none}
.timer{font-size:22px;color:#e74c3c;margin:14px 0}

.object{
  position:absolute;
  animation-fill-mode:both;
  animation-timing-function:cubic-bezier(.22,.61,.36,1);
  transform:rotate(var(--rot,0deg))
}
.object.selected{
  outline:3px solid #4caf50;
  outline-offset:2px;
  box-shadow:0 0 0 3px rgba(76,175,80,.35);
}

.figure{box-shadow:0 6px 10px rgba(0,0,0,.25),inset 0 2px 3px rgba(255,255,255,.6),inset 0 -3px 6px rgba(0,0,0,.25)}
.figure::after{content:'';position:absolute;inset:3px;border-radius:inherit;background:linear-gradient(to bottom right,rgba(255,255,255,.35),rgba(255,255,255,0));pointer-events:none}
.figure.triangle{box-shadow:none;filter:drop-shadow(0 6px 8px rgba(0,0,0,.35))}

.from-top{animation-name:fromTop}
.from-bottom{animation-name:fromBottom}
.from-left{animation-name:fromLeft}
.from-right{animation-name:fromRight}

@keyframes fromTop{0%{transform:translateY(-120px) rotate(var(--rot)) scale(.9);opacity:0}80%{transform:translateY(0) rotate(var(--rot)) scale(1.05);opacity:1}100%{transform:translateY(0) rotate(var(--rot)) scale(1)}}
@keyframes fromBottom{0%{transform:translateY(120px) rotate(var(--rot)) scale(.9);opacity:0}80%{transform:translateY(0) rotate(var(--rot)) scale(1.05);opacity:1}100%{transform:translateY(0) rotate(var(--rot)) scale(1)}}
@keyframes fromLeft{0%{transform:translateX(-120px) rotate(var(--rot)) scale(.9);opacity:0}80%{transform:translateX(0) rotate(var(--rot)) scale(1.05);opacity:1}100%{transform:translateX(0) rotate(var(--rot)) scale(1)}}
@keyframes fromRight{0%{transform:translateX(120px) rotate(var(--rot)) scale(.9);opacity:0}80%{transform:translateX(0) rotate(var(--rot)) scale(1.05);opacity:1}100%{transform:translateX(0) rotate(var(--rot)) scale(1)}}

.match{width:94px;height:6px;border-radius:4px;background:linear-gradient(#deb887,#cfa36a 40%,#b88952)}
.match::after{content:'';position:absolute;right:-6px;top:-4px;width:14px;height:14px;border-radius:50%;background:radial-gradient(circle,#ff6b6b,#b22222)}

.number{
  width:48px;height:48px;border-radius:50%;
  background:#fff;color:#222;
  display:flex;align-items:center;justify-content:center;
  font-size:20px;font-weight:700
}

@keyframes pop{
  0%{transform:scale(.85);opacity:0}
  100%{transform:scale(1);opacity:1}
}

.instruction-step{
  margin:12px 0;
  font-size:18px;
  color:#2c3e50;
  min-height:24px;
}

.info-section {
  margin-top: 20px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 16px;
  box-shadow: inset 2px 2px 4px #d1d5db, inset -2px -2px 4px #ffffff;
  text-align: justify;
  font-size: 14px;
  color: #495057;
  line-height: 1.5;
}

.info-section h3 {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
  font-size: 16px;
  font-weight: 600;
  color: #2c3e50;
  text-align: center;
}

.info-section p {
  margin: 8px 0;
}
</style>
</head>

<body>
<div class="game">
<h1>üß† MatchMind: –§–æ—Ç–æ–ü–∞–º—è—Ç—å</h1>

<div id="startScreen" class="controls-start">
  <p style="font-size:17px;color:#2e2e2e;margin:16px 0">‚úèÔ∏è <b>–ü–æ–¥–≥–æ—Ç–æ–≤—å: –ª–∏—Å—Ç –±—É–º–∞–≥–∏ –∏ –∫–∞—Ä–∞–Ω–¥–∞—à (–∏–ª–∏ —Ä—É—á–∫—É)</b></p>
  <div>
    <input type="number" id="count" min="0" max="15" value="4">
    <button id="startBtn">–ù–∞—á–∞—Ç—å</button>
  </div>
  <div class="mode-buttons">
    <button data-mode="matches">–°–ø–∏—á–∫–∏</button>
    <button data-mode="figures">–§–∏–≥—É—Ä—ã</button>
    <button data-mode="numbers">–ß–∏—Å–ª–∞</button>
  </div>
  
  <div id="instructions">
    <div class="instruction">
	<b>
      üß† <b>–ó–∞–ø–æ–º–Ω–∏ –æ–±—ä–µ–∫—Ç—ã</b><br>
      üìù <b>–ù–∞—Ä–∏—Å—É–π –∏—Ö –Ω–∞ –±—É–º–∞–≥–µ</b><br>
      üëÄ <b>–ù–∞–∂–º–∏ ¬´–ü–æ–∫–∞–∑–∞—Ç—å¬ª –∏ –æ—Ç–º–µ—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è</b>
    </div>
  </div>
  
  <div class="info-section">
    <h3>‚ÑπÔ∏è –û–± –∏–≥—Ä–µ</h3>
    <p>–ù–∞—à —Ç—Ä–µ–Ω–∞–∂—ë—Ä –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –Ω–∞—É—á–Ω–æ –¥–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö —Ä–∞–±–æ—Ç—ã –º–æ–∑–≥–∞. </p>
	 <p><b> –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ–º –ø–µ—Ä–µ–Ω–æ—Å–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å —ç–∫—Ä–∞–Ω–∞ –Ω–∞ –±—É–º–∞–≥—É, –∞–∫—Ç–∏–≤–∏–∑–∏—Ä—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å.</b></p>
    <p>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–µ—Ç–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä—ã–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º: —É–∂–µ —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤—ã –∑–∞–º–µ—Ç–∏—Ç–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—é.</p>
    <p>–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±—ã—á–Ω—ã—Ö –∏–≥—Ä –Ω–∞ –ø–∞–º—è—Ç—å, –Ω–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω—É—é —Ä–∞–±–æ—Ç—É –Ω–∞–¥ —Ä–∞–∑–≤–∏—Ç–∏–µ–º –≤–∞—à–∏—Ö –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π.</p>
  </div>
</div>

<div id="step1" class="instruction-step hidden">üß† <b>–ó–∞–ø–æ–º–Ω–∏ –æ–±—ä–µ–∫—Ç—ã</b></div>

<div id="timer" class="timer hidden"></div>
<div id="field" class="field hidden"></div>

<div id="step2" class="instruction-step hidden">üìù <b>–ù–∞—Ä–∏—Å—É–π –∏—Ö –Ω–∞ –±—É–º–∞–≥–µ</b></div>

<div style="margin-top:5px">
  <button id="showBtn" class="hidden">–ü–æ–∫–∞–∑–∞—Ç—å</button>
</div>

<div id="step3" class="instruction-step hidden">üëÄ <b>–ù–∞–∂–º–∏ ¬´–ü–æ–∫–∞–∑–∞—Ç—å¬ª –∏ –æ—Ç–º–µ—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è</b></div>

<button id="resetBtn" class="hidden" style="margin-top:8px">–ù–æ–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞</button>

<div id="result" class="hidden"></div>
<div id="achievement" class="hidden"></div>
</div>

<script>
const SAFE = 10;
const CLICK_TOLERANCE = /Mobi|Android/i.test(navigator.userAgent) ? 14 : 7;
const animDirs = ['from-top', 'from-bottom', 'from-left', 'from-right'];
const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6', '#e67e22'];

const field = document.getElementById('field');
const startBtn = document.getElementById('startBtn');
const showBtn = document.getElementById('showBtn');
const resetBtn = document.getElementById('resetBtn');
const timerEl = document.getElementById('timer');
const result = document.getElementById('result');
const achievement = document.getElementById('achievement');
const countInput = document.getElementById('count');
const modeBtns = document.querySelectorAll('.mode-buttons button');
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const step3 = document.getElementById('step3');

let mode = null, total = 0, selected = 0, timer;

// Input validation
countInput.addEventListener('input', () => {
  let v = +countInput.value;
  let corrected = false;
  if (v > 15) { v = 15; corrected = true; }
  if (v < 0) { v = 0; corrected = true; }
  countInput.value = v;
  if (corrected) {
    countInput.classList.remove('input-warn');
    void countInput.offsetWidth;
    countInput.classList.add('input-warn');
    setTimeout(() => countInput.classList.remove('input-warn'), 350);
  }
});

// Mode selection
modeBtns.forEach(b => {
  b.onclick = () => {
    modeBtns.forEach(x => x.classList.remove('active'));
    b.classList.add('active');
    mode = b.dataset.mode;
  };
});

// Start game
startBtn.onclick = () => {
  const countValue = +countInput.value;
  if (countValue < 1 || countValue > 15) {
    countInput.classList.remove('input-warn');
    void countInput.offsetWidth;
    countInput.classList.add('input-warn');
    setTimeout(() => countInput.classList.remove('input-warn'), 350);
    return;
  }
  if (!mode) {
    modeBtns.forEach(btn => {
      btn.classList.remove('warn');
      void btn.offsetWidth;
      btn.classList.add('warn');
    });
    return;
  }
  
  total = countValue;
  document.getElementById('startScreen').classList.add('hidden');
  step1.classList.remove('hidden');
  field.classList.remove('hidden');
  timerEl.classList.remove('hidden');
  generate();
  startTimer();
};

function startTimer() {
  let t = 15;
  timerEl.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${t} —Å–µ–∫`;
  timer = setInterval(() => {
    t--;
    timerEl.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${t} —Å–µ–∫`;
    if (t <= 0) {
      clearInterval(timer);
      field.classList.add('hidden');
      timerEl.classList.add('hidden');
      step1.classList.add('hidden');
      step2.classList.remove('hidden');
      showBtn.classList.remove('hidden');
      step3.classList.remove('hidden');
    }
  }, 1000);
}

showBtn.onclick = () => {
  step2.classList.add('hidden');
  step3.classList.add('hidden');
  resetBtn.style.marginTop = '5px';
  result.style.marginTop = '7px';
  field.classList.remove('hidden');
  field.classList.add('check');
  showBtn.classList.add('hidden');
  resetBtn.classList.remove('hidden');
  updateResult();
};

resetBtn.onclick = () => {
  field.innerHTML = '';
  field.classList.add('hidden');
  timerEl.classList.add('hidden');
  step1.classList.add('hidden');
  step2.classList.add('hidden');
  step3.classList.add('hidden');
  showBtn.classList.add('hidden');
  resetBtn.classList.add('hidden');
  result.classList.add('hidden');
  achievement.classList.add('hidden');
  document.getElementById('startScreen').classList.remove('hidden');
  mode = null;
  total = 0;
  selected = 0;
  if (timer) clearInterval(timer);
  modeBtns.forEach(btn => btn.classList.remove('active'));
};

field.onclick = e => {
  if (!field.classList.contains('check')) return;
  const fr = field.getBoundingClientRect();
  const x = e.clientX - fr.left;
  const y = e.clientY - fr.top;

  field.querySelectorAll('.object').forEach(el => {
    if (el.classList.contains('selected')) return;
    const r = el.getBoundingClientRect();
    const bx = r.left - fr.left - CLICK_TOLERANCE;
    const by = r.top - fr.top - CLICK_TOLERANCE;
    const bw = r.width + CLICK_TOLERANCE * 2;
    const bh = r.height + CLICK_TOLERANCE * 2;

    if (x >= bx && x <= bx + bw && y >= by && y <= by + bh) {
      el.classList.add('selected');
      selected++;
      updateResult();
    }
  });
};

function updateResult() {
  result.textContent = `–û—Ç–º–µ—á–µ–Ω–æ: ${selected} –∏–∑ ${total}`;
  result.classList.remove('hidden');
  updateAchievement();
}

function updateAchievement() {
  achievement.style.animation = 'none';
  void achievement.offsetWidth;
  achievement.style.animation = 'pop .35s ease';
  const r = total > 0 ? selected / total : 0;
  achievement.textContent =
    r === 1 ? 'üß†‚ú® –ò–¥–µ–∞–ª—å–Ω–æ!'
    : r >= 0.8 ? 'üß†üëç –û—Ç–ª–∏—á–Ω–æ!'
    : r >= 0.5 ? 'üß† –ù–µ–ø–ª–æ—Ö–æ'
    : '';
  achievement.classList.remove('hidden');
}

function intersects(a, b) {
  return !(
    a.left + a.width <= b.left ||
    a.left >= b.left + b.width ||
    a.top + a.height <= b.top ||
    a.top >= b.top + b.height
  );
}

function generate() {
  field.innerHTML = '';
  selected = 0;
  const padding = 10;
  const fw = field.clientWidth;
  const fh = field.clientHeight;
  let placed = [], attempts = 0;

  while (placed.length < total && attempts < 3000) {
    attempts++;
    const box = createBox();
    field.appendChild(box.el);

    const x = padding + Math.random() * (fw - box.el.offsetWidth - padding * 2);
    const y = padding + Math.random() * (fh - box.el.offsetHeight - padding * 2);
    box.el.style.left = x + 'px';
    box.el.style.top = y + 'px';

    const r2 = box.el.getBoundingClientRect();
    const fr = field.getBoundingClientRect();

    if (
      r2.left < fr.left + SAFE ||
      r2.top < fr.top + SAFE ||
      r2.right > fr.right - SAFE ||
      r2.bottom > fr.bottom - SAFE ||
      placed.some(p => intersects(r2, p))
    ) {
      field.removeChild(box.el);
      continue;
    }

    placed.push(r2);
    box.el.classList.add(animDirs[Math.floor(Math.random() * 4)]);
    box.el.style.animationDuration = (0.4 + Math.random() * 0.6) + 's';
    box.el.style.animationDelay = placed.length * 80 + 'ms';
  }

  if (placed.length < total) generate();
}

function createBox() {
  const el = document.createElement('div');
  el.classList.add('object');

  if (mode === 'matches') {
    el.classList.add('match');
    el.style.setProperty('--rot', `${Math.random() * 360}deg`);
  }

  if (mode === 'numbers') {
    el.classList.add('number');
    el.textContent = Math.floor(Math.random() * 10);
  }

  if (mode === 'figures') {
    el.classList.add('figure');
    const shape = ['square', 'circle', 'triangle'][Math.floor(Math.random() * 3)];
    const color = colors[Math.floor(Math.random() * colors.length)];

    if (shape === 'triangle') {
      el.classList.add('triangle');
      el.style.width = '0';
      el.style.height = '0';
      el.style.borderLeft = '30px solid transparent';
      el.style.borderRight = '30px solid transparent';
      el.style.borderBottom = '60px solid ' + color;
    } else {
      el.style.width = '60px';
      el.style.height = '60px';
      el.style.background = color;
      if (shape === 'circle') el.style.borderRadius = '50%';
    }
  }

  return { el };
}

// Telegram WebApp
if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
  Telegram.WebApp.expand();
  Telegram.WebApp.disableVerticalSwipes();
}
</script>
</body>
</html>

